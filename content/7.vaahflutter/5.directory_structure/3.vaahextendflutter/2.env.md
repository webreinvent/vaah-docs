---
title:  Environments
---

::alert{type="warning" class="flex items-center p-4 mb-4 text-sm text-yellow-800 border border-yellow-300 rounded-lg bg-yellow-50 dark:bg-gray-800 dark:text-yellow-300 dark:border-yellow-800" role="alert"} 
Dependencies   
None
::



## Running the app in different environments

- In the default environment
```bash
flutter run

OR

flutter run --dart-define="ENV_PATH=assets/env/default.json"
```

- In the development environment
```bash
flutter run --dart-define="ENV_PATH=assets/env/develop.json"
```

- In the staging environment
```bash
flutter run --dart-define="ENV_PATH=assets/env/staging.json"
```

- In the Production environment
```bash
flutter run --dart-define="ENV_PATH=assets/env/production.json"
```




#### Example: `assets/env/develop.json`
```json
{
  "app_title": "VaahFlutter",
  "app_title_short": "VaahFlutter",
  "env_type": "Develop",
  "version": "1.0.0",
  "build": "1",
  "backend_url": "",
  "api_url": "",
  "firebase_id": null,
  "timeout_limit": 20,
  "enable_local_logs": true,
  "enable_cloud_logs": false,
  "enable_api_log_interceptor": false,
  "sentry_config": null,
  "push_notifications_service_type": "none",
  "internal_notifications_service_type": "none",
  "one_signal_config": null,
  "pusher_config": null,
  "show_debug_panel": true,
  "debug_panel_color": 3422552064
}
```

### Step 2: Update `pubspec.yaml`
Next, update the `pubspec.yaml` file to include the paths to these JSON files in the `assets` section. This step is crucial because Flutter needs to know about the assets that should be bundled with the application.

```yaml
flutter:
  assets:
    - assets/env/develop.json
    - assets/env/staging.json
    - assets/env/production.json
```

### Step 3: Fetch Configuration from JSON Files
To fetch the configuration settings from the specified JSON file, we have used the `String.fromEnvironment` method in Dart. This method allows us to pass environment variables to your Flutter application at runtime.

#### Source Code

```dart
import 'dart:convert';
import 'dart:io';

import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:get/get.dart';
import 'package:json_annotation/json_annotation.dart';

import '../services/logging_library/logging_library.dart';
import 'logging.dart';
import 'notification.dart';

part 'env.g.dart';

class EnvController extends GetxController {
  EnvironmentConfig _config = EnvironmentConfig.defaultConfig();
  EnvironmentConfig get config => _config;

  Future<void> initialize() async {
    try {
      const String envPath = String.fromEnvironment("ENV_PATH");
      if (envPath.isEmpty) {
        Log.warning("INVALID ENVIRONMENT PATH");
        return;
      }
      Log.success("ENVIRONMENT PATH: $envPath");
      final String jsonConfig = await rootBundle.loadString(envPath);
      if (jsonConfig.isNotEmpty) {
        final Map<String, dynamic> json = jsonDecode(jsonConfig);
        _config = EnvironmentConfig.fromJson(json);
      } else {
        throw Exception('Environment configuration not found for key: $envPath');
      }
    } catch (error, stackTrace) {
      Log.exception(error, stackTrace: stackTrace);
      exit(0);
    }
  }
}

@JsonSerializable(fieldRename: FieldRename.snake)
class EnvironmentConfig {
  const EnvironmentConfig({
    required this.appTitle,
    required this.appTitleShort,
    required this.envType,
    required this.version,
    required this.build,
    required this.apiUrl,
    this.firebaseId,
    required this.timeoutLimit,
    required this.enableLocalLogs,
    required this.enableCloudLogs,
    required this.enableApiLogInterceptor,
    this.sentryConfig,
    required this.pushNotificationsServiceType,
    required this.internalNotificationsServiceType,
    this.oneSignalConfig,
    this.pusherConfig,
    required this.showDebugPanel,
    required this.debugPanelColor,
  });

  final String appTitle;
  final String appTitleShort;
  final String envType;
  final String version;
  final String build;
  final String apiUrl;
  final String? firebaseId;
  final int timeoutLimit;
  final bool enableLocalLogs;
  final bool enableCloudLogs;
  final bool enableApiLogInterceptor;
  final SentryConfig? sentryConfig;
  final PushNotificationsServiceType pushNotificationsServiceType;
  final InternalNotificationsServiceType internalNotificationsServiceType;
  final OneSignalConfig? oneSignalConfig;
  final PusherConfig? pusherConfig;
  final bool showDebugPanel;
  @JsonKey(fromJson: _colorFromJson, toJson: _colorToJson)
  final Color debugPanelColor;

  static Color _colorFromJson(int color) {
    return Color(color);
  }

  static int _colorToJson(Color color) {
    return color.value;
  }

  factory EnvironmentConfig.fromJson(Map<String, dynamic> json) =>
      _$EnvironmentConfigFromJson(json);

  Map<String, dynamic> toJson() => _$EnvironmentConfigToJson(this);

  static EnvironmentConfig get getConfig {
    final bool isRegistered = Get.isRegistered<EnvController>();
    if (isRegistered) {
      EnvController envController = Get.find<EnvController>();
      return envController.config;
    } else {
      return EnvironmentConfig.defaultConfig();
    }
  }

  factory EnvironmentConfig.defaultConfig() {
    return EnvironmentConfig(
      appTitle: 'VaahFlutter',
      appTitleShort: 'VaahFlutter',
      envType: 'default',
      version: '1.0.0',
      build: '1',
      apiUrl: '',
      timeoutLimit: 20, // 20 seconds
      enableLocalLogs: true,
      enableCloudLogs: false,
      enableApiLogInterceptor: false,
      pushNotificationsServiceType: PushNotificationsServiceType.none,
      internalNotificationsServiceType: InternalNotificationsServiceType.none,
      showDebugPanel: true,
      debugPanelColor: Colors.black.withOpacity(0.8),
    );
  }
}

// Example 
class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final EnvironmentConfig config = EnvironmentConfig.getConfig;

    return MaterialApp(
      title: config.appTitle,
      home: HomeScreen(),
    );
  }
}
```

### Step 4: Running the Application with Environment Config
To run the Flutter application with a specific environment configuration, use the `flutter run` command with the `--dart-define` flag. This flag allows you to define the environment variable `ENV_PATH` at runtime.

```sh
flutter run --dart-define="ENV_PATH=assets/env/develop.json"
```

Replace `develop.json` with the appropriate JSON file for the environment you wish to target (e.g., `staging.json`, `production.json`, `test.json`).


By following these steps, you can easily manage different configurations for various environments in your Flutter application. This approach uses JSON files to store environment-specific settings and leverages the power of Flutter's asset management and `dart-define` feature to switch configurations at runtime.